# Тестовое задание "e_mail"

Представьте, что вы пишите backend для почтового сервера. Ваш код не реализует SMTP/POP3/IMAP (за это отвечают другие компоненты), но предоставляет сервисы хранения (скажем, в postgres) в виде REST API (можно использовать любой фреймворк, скажем pyramid, django или что-то асинхронное). Для простоты уберем регистрацию пользователей, сосредоточимся только на хранении самих писем. У каждого пользователя есть почтовый ящик с 2-мя каталогами (inbox и sent). API позволяет пользователю отправить письмо нескольким адресатам. И тогда письмо сохраняется в каталог sent отправителя и в каталог inbox каждого из получателей. Также API должно позволять пользователям просмотреть содержимое своих каталогов (список писем), получить содержание письма, снять/поставить отметку о прочтении или вообще удалить письмо. Письмом будем считать объект с заголовком, текстовым содержанием, полем from и набором адресатов (to).


## Инструкция по использованию

1. Клонируем проект с github репозитория

2. Создаём виртуальное окружение python

a) с использованием pipenv

`pipenv install`

активируем виртуальное окружение

`pipenv shell`

б) при помощи virtualenv

`python3 -m venv <myenvname> -r requirements.txt`

`<myenvname>/bin/activate`

3. Накатываем миграции в БД (по-умолчанию в качестве БД используется sqlite)
`python manage.py migrate`

4. Создаём суперпользователя

`python manage.py createsuperuser`

и следуя инструкциям задаём логин, email, пароль

5. Запускаем сервер (приложение в DEBUG режиме!)

`python manage.py runserver`


## Использование API (на примере браузера)

1. Авторизуемся по адресу (по-умолчанию 127.0.0.1:8000/admin/) используя учётную запись созданного ранее суперпользователя

2. Создаём ещё несколько пользователей для работы (Важно! Созданные пользователи должны иметь 'Staff status')

3.Используем api


## Доступные API методы (на примере браузера)

1. Создание письма

`/api/create/`

заполняем форму, нажимаем кнопку 'POST'

2. Просмотр исходящей почты пользователя

`/api/sent/`

3. Детальный просмотр письма c id=1

`api/sent/1`

4. Отмечаем письмо как прочитанное

`/api/sent/1?new=False` или `/api/sent/1?new=0`

5. Удаляем письмо

на странице просмотра письма `/api/sent/1` нажимем кнопку 'DELETE' (эквивалентно DELETE запросу на этот же url)

6. Открываем новую вкладку в браузере в режиме инкогнито, авторизуемся под учётной записью по адресу `/admin/`, кому отослали письмо и переходим во входящие 

`/api/inbox/`

7. Детальный просмотр полученного письма с id=1

`/api/inbox/1`

8. Отмечаем полученное письмо как непрочитанное
`/api/inbox/1?new=True` или `/api/inbox/1?new=1`
